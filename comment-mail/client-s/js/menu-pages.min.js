(function(b){var a={},d=b(window),c=b(document);a.onReady=function(){var i="comment_mail",s="comment-mail",k=b("."+s+"-menu-page"),l=b("."+s+"-menu-page-area"),p=b("."+s+"-menu-page-table"),m=b("."+s+"-menu-page-form"),h=b("."+s+"-menu-page-stats"),n=window[i+"_vars"],t=window[i+"_i18n"],j={search_contains:true,disable_search_threshold:10,allow_single_deselect:true},o=[],r={lineNumbers:false,matchBrackets:true,theme:"ambiance",tabSize:3,indentWithTabs:true,extraKeys:{F11:function(u){if(u.getOption("fullScreen")){u.setOption("fullScreen",false),b("#adminmenuwrap, #wpadminbar").show()}else{u.setOption("fullScreen",true),b("#adminmenuwrap, #wpadminbar").hide()}}}};l.find("[data-pmp-action]").on("click",function(w){w.preventDefault(),w.stopImmediatePropagation();var v=b(this),u=v.data();if(typeof u.pmpConfirmation!=="string"||confirm(u.pmpConfirmation)){location.href=u.pmpAction}});l.find('[data-toggle~="date-time-picker"]').datetimepicker({lang:"en",lazyInit:true,validateOnBlur:false,format:"M j, Y H:i",i18n:t.dateTimePickerI18n});k.find("[data-cm-mode]").each(function(){var w=b(this),u=w.data("cmMode"),v=w.data("cmHeight"),x=w.find("textarea");if(x.length!==1){return}window.CodeMirror=CodeMirror||{fromTextArea:function(){}};w.addClass("cm"),o.push(CodeMirror.fromTextArea(x[0],b.extend({},r,{mode:u}))),o[o.length-1].setSize(null,v)});var e=function(){b.each(o,function(u,v){v.refresh()})};k.find(".pmp-panels-open").on("click",function(){k.find(".pmp-panel-heading").addClass("open").next(".pmp-panel-body").addClass("open"),e()});k.find(".pmp-panels-close").on("click",function(){k.find(".pmp-panel-heading").removeClass("open").next(".pmp-panel-body").removeClass("open"),e()});k.find(".pmp-panel-heading").on("click",function(u){u.preventDefault(),u.stopImmediatePropagation();b(this).toggleClass("open").next(".pmp-panel-body").toggleClass("open"),e()});k.find('select[name$="\\[enable\\]"], select[name$="_enable\\]"]').not(".no-if-enabled").not(".no-if-disabled").on("change",function(){var C=b(this),x=b.trim(C.val()),A=C.closest(".pmp-panel");var B=x!==""&&x!=="0",z=!B;var y=".pmp-panel-if-enabled",v=".pmp-panel-if-enabled-show";var w=".pmp-panel-if-disabled",u=".pmp-panel-if-disabled-show";if(B){A.find(y+","+v).show().css("opacity",1).find(":input").removeAttr("disabled")}else{A.find(y+","+v).css("opacity",0.2).find(":input").attr("disabled","disabled"),A.find(v).hide()}if(z){A.find(w+","+u).show().css("opacity",1).find(":input").removeAttr("disabled")}else{A.find(w+","+u).css("opacity",0.2).find(":input").attr("disabled","disabled"),A.find(u).hide()}e()}).trigger("change");p.find("> form").on("submit",function(){var y=b(this),v=y.find("#bulk-action-selector-top"),x=y.find("#bulk-action-selector-bottom"),w=v.val(),u=x.val();if(w==="reconfirm"||u==="reconfirm"){return confirm(t.bulkReconfirmConfirmation)}else{if(w==="delete"||u==="delete"){return confirm(t.bulkDeleteConfirmation)}}return true});var g={$select:m.find("> form tr.pmp-sub-form-post-id select"),$input:m.find("> form tr.pmp-sub-form-post-id input"),progress:'<img src="'+n.pluginUrl+'/client-s/images/tiny-progress-bar.gif" class="pmp-progress" />'};if(g.$select.length){g.lastId=b.trim(g.$select.val())}else{g.lastId=b.trim(g.$input.val())}g.handler=function(){var v=b(this),w={},u={};g.newId=b.trim(v.val());if(g.newId===g.lastId){return}g.lastId=g.newId;w.$lastRow=m.find("> form tr.pmp-sub-form-comment-id"),w.$lastChosenContainer=w.$lastRow.find(".chosen-container"),w.$lastInput=w.$lastRow.find(":input");if(!w.$lastRow.length||!w.$lastInput.length){return}w.$lastChosenContainer.remove(),w.$lastInput.replaceWith(b(g.progress));u[i]={sub_form_comment_id_row_via_ajax:{post_id:g.newId}},b.get(n.ajaxEndpoint,u,function(x){w.$newRow=b(x),w.$lastRow.replaceWith(w.$newRow),w.$newRow.find("select").chosen(j)})};var q={$select:m.find("> form tr.pmp-sub-form-user-id select"),$input:m.find("> form tr.pmp-sub-form-user-id input"),$progress:b('<img src="'+n.pluginUrl+'/client-s/images/tiny-progress-bar.gif" class="pmp-progress" />')};if(q.$select.length){q.lastId=b.trim(q.$select.val())}else{q.lastId=b.trim(q.$input.val())}q.handler=function(){var z=b(this),y,u,w,A,x,v={};q.newId=b.trim(z.val());if(q.newId===q.lastId){return}q.lastId=q.newId;y=m.find("> form tr.pmp-sub-form-email th"),u=m.find("> form tr.pmp-sub-form-email input"),w=m.find("> form tr.pmp-sub-form-fname input"),A=m.find("> form tr.pmp-sub-form-lname input"),x=m.find("> form tr.pmp-sub-form-insertion-ip input");if(!y.length||(u.length+w.length+A.length)<1){return}q.$progress.remove(),y.append(q.$progress);v[i]={sub_form_user_id_info_via_ajax:{user_id:q.newId}},b.get(n.ajaxEndpoint,v,function(B){u.val(B.email),w.val(B.fname),A.val(B.lname),x.val(B.ip);q.$progress.remove()})};g.$select.on("change",g.handler).chosen(j),g.$input.on("blur",g.handler);m.find("> form tr.pmp-sub-form-comment-id select").chosen(j);q.$select.on("change",q.handler).chosen(j),q.$input.on("blur",q.handler);m.find("> form tr.pmp-sub-form-status select").on("change",function(){var x=b(this),u=b.trim(x.val()),v=x.siblings(".checkbox"),w=v.find("input");if(u==="unconfirmed"){v.show()}else{w.prop("checked",false),v.hide()}}).trigger("change").chosen(j);m.find("> form tr.pmp-sub-form-deliver select").chosen(j);m.find("> form").on("submit",function(w){var v=b(this),x="",u=[];v.find(".form-required :input[required]").each(function(){var y=b(this),z=b.trim(y.val());if(typeof z==="undefined"||z==="0"||z===""){u.push(this)}});b.each(u,function(){x+=b.trim(v.find('label[for="'+this.id+'"]').text().replace(/\s+/g," "))+"\n"});if((x=b.trim(x)).length){w.preventDefault(),w.stopImmediatePropagation(),alert(x);return false}});if(h.length){postboxes.save_state=postboxes.save_order=function(){};postboxes.add_postbox_toggles(window.pagenow)}var f={$selects:h.find(".pmp-stats-view select"),$buttons:h.find(".pmp-stats-view button"),progress:'<img src="'+n.pluginUrl+'/client-s/images/tiny-progress-bar.gif" class="pmp-progress" />',chartOps:{responsive:true}};f.handler=function(){var A=b(this),w=A.closest("form"),z=A.closest(".pmp-stats-view"),v=z.find(".pmp-note.pmp-error"),u=z.find(".pmp-progress"),y=z.find("canvas"),x=z.data("chart");if(x){x.destroy()}v.remove(),y.remove();u.remove(),z.append(u=b(f.progress));b.get(n.ajaxEndpoint,w.serialize(),function(D){if(!D){return}if(typeof D.errors==="string"){z.append(b(D.errors)),u.remove();return}z.append(y=b("<canvas></canvas>"));var E=y.get(0).getContext("2d");var B=b.extend({},f.chartOps,D.options);var C=new Chart(E).Bar(D.data,B);z.data("chart",C),u.remove()})};f.$selects.chosen(j),f.$buttons.on("click",f.handler),f.$buttons.filter("[data-auto-chart]").trigger("click");h.find("#comment-mail-stats-form-subs-overview-type").on("change",function(){var w=b(this),x=w.val(),u=w.closest(".pmp-stats-view"),v=u.find("tr.pmp-stats-form-by");v.css({opacity:x==="event_subscribed_most_popular_posts"?0.2:1})}).trigger("change")};c.ready(a.onReady)})(jQuery);